{% extends "movies/base.html" %}

{% comment %} google gemini {% endcomment %}
{% block extra_meta %}
    <meta property="og:type" content="video.movie">
    <meta property="og:title" content="{{ movie.title }}">
    <meta property="og:description" content="Watch {{ movie.title }} on our platform.">
    <meta property="og:image" content="{{ movie.poster.url }}"> <meta property="og:url" content="{{ request.build_absolute_uri }}">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ movie.title }}">
    <meta name="twitter:image" content="{{ movie.poster.url }}">

     <meta property="og:type" content="video.movie">
<meta property="og:title" content="{{ movie.title }}">
<meta property="og:description" content="Check out {{ movie.title }} on our site!">

<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ movie.poster.url }}">

<meta property="og:url" content="{{ request.build_absolute_uri }}">
{% endblock %}
{% comment %} google gemini {% endcomment %}

{% block content %}
<div class="bg-dark text-light py-5">
    <div class="container my-5">

        <div class="row g-4">
            <!-- Poster -->
            <div class="col-md-4">
                <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" 
                     class="img-fluid rounded shadow" 
                     alt="{{ movie.title }}">
            </div>

            <!-- Movie Info -->
            <div class="col-md-8">
                <h1 class="fw-bold">{{ movie.title }}</h1>

                {% if movie.belongs_to_collection %}
                    <h4 class="text-muted">{{ movie.belongs_to_collection.name }}</h4>
                {% endif %}

                {% if movie.tagline %}
                    <p class="fst-italic text-warning">{{ movie.tagline }}</p>
                {% endif %}

                <!-- Genres -->
                
                <div class="mb-3">
                    {% for genre in movie.genres.all %}
                        <span class="badge bg-secondary me-1">{{ genre.name }}</span>
                    {% endfor %}
                </div>

                <!-- Overview -->
                <p>{{ movie.overview }}</p>

                <!-- Details List -->
                <ul class="list-unstyled">
                    <li><strong>Runtime:</strong> {{ movie.runtime }} min</li>
                    <li><strong>Release Date:</strong> {{ movie.release_date }}</li>
                    <li>
                        <strong>TMDB Rating:</strong> {{ movie.vote_average }}/10 
                        ({{ movie.vote_count }} votes)
                    </li>

                    <!-- Rating Form -->
                    {% if user.is_authenticated %}
                    <li class="mt-3">
                        <form method="post" action="{% url 'rate_movie' tmdb_id=movie.tmdb_id %}">
                            {% csrf_token %}
                            
                            <label class="form-label d-block">Rate this movie</label>
                            <div class="rating">
                                {% for i in rating_range %}
                                    <input type="radio" name="score" value="{{ i }}" id="star{{ i }}"
                                    {% if user_rating %}
                                        {% if user_rating.score == i %}checked{% endif %}>
                                    {% endif %}
                                    <label for="star{{ i }}">â˜…</label>
                                {% endfor %}
                               
                            </div>
                             <input type="hidden" name="rating_id" value="{{ user_rating.id|default:''}}">
                            <button type="submit" class="btn btn-primary mt-2">Submit Rating</button>
                        </form>
                    </li>
                    {% else %}
                    
                        <li class="mt-3">
                            <p><a href="{% url 'account_login' %}" class="btn btn-outline-light btn-sm">Log in</a> to rate this movie.</p>
                        </li>
                    {% endif %}


                    <li>
                        <strong>Languages:</strong>
                        {% for lang in movie.spoken_languages.all %}
                            <span class="badge bg-secondary me-1">{{ lang.name }}</span>
                        {% endfor %}
                    </li>

                    <li>
                        <strong>Countries:</strong>
                        {% for country in movie.origin_country.all %}
                            <span class="badge bg-secondary me-1">{{ country }}</span>
                        {% endfor %}
                    </li>
                </ul>

                <!-- External Links -->
                <div class="mt-4">
                    {% if movie.homepage %}
                        <a href="{{ movie.homepage }}" class="btn btn-warning me-2" target="_blank">Official Website</a>
                    {% endif %}
                    {% if movie.imdb_id %}
                        <a href="https://www.imdb.com/title/{{ movie.imdb_id }}" class="btn btn-warning me-2" target="_blank">IMDb</a>
                    {% endif %}
                </div>
                <div>
                <div class="mt-3 d-flex gap-2 align-items-center">
                    <span class="fw-semibold me-2">Share:</span>
                    <a
                    href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="btn btn-outline-primary btn-sm"
                    title="Share on Facebook"
                    >
                    <i class="bi bi-facebook"></i> Facebook
                    </a>


                     <a
                        href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ movie.title|urlencode }}"
                        target="_blank"
                        class="btn btn-outline-primary btn-sm"
                        title="share one Twitter">
                        <i class="bi bi-twitter"></i> Twitter
                    </a>

                    <a 
                        href="https://api.whatsapp.com/send?text={{ movie.title|urlencode }}%20{{ request.build_absolute_uri|urlencode }}" 
                        target="_blank" 
                        class="btn btn-outline-primary btn-sm" 
                        title="Share on WhatsApp">
                        <i class="bi bi-whatsapp"></i> WhatsApp
                    </a>

                    <a 
                        href="https://www.pinterest.com/pin/create/button/?url={{ request.build_absolute_uri }}&description={{ movie.title|urlencode }}"
                        target="_blank" 
                        class="btn btn-outline-primary btn-sm" 
                        title="Post on Pinterest">
                        <i class="bi bi-pinterest"></i> pinterest
                    </a>

                    <a 
    href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}"
    target="_blank" 
    rel="noopener noreferrer"
    class="btn btn-outline-primary btn-sm" 
    title="Share on LinkedIn">
    <i class="bi bi-linkedin"></i> LinkedIn
</a>
                </div>
                
            </div>
            </div>

            
        </div>

    </div>

    <form method="POST" action="{% url 'add_comment' tmdb_id=movie.tmdb_id%}" class="mb-6 px-2 mx-2">
        {% csrf_token %}
        
        <div class="input-group">
            <input type="text"  required value="" name="content" class="form-control" placeholder="Your comment here">
            <button type="submit" class="btn btn-primary">Post Comment</button>
        </div>

    </form>
    
<div class="container mt-5 mb-5">
    <div class="row">
        <div class="col-12 col-md-10 col-lg-8 mx-auto">
            <h3 class="h4 fw-bold mb-4">Comments</h3>
            
            <div class="comment-section">
                {% for comment in comments %}
                    <div class="card mb-3 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="fw-bold text-primary">
                                    <i class="bi bi-person-fill me-1"></i>{{ comment.user.username }}
                                </span>
                                <small class="text-muted">
                                    {{ comment.commented_at|date:"M d, Y H:i" }}
                                </small>
                            </div>
                            <p class="card-text text-dark-emphasis mb-0">
                                {{ comment.content }}
                            </p>
                        </div>
                    </div>
                {% empty %}
                    <div class="text-center py-5 bg-light rounded">
                        <i class="bi bi-chat-dots fs-1 text-muted"></i>
                        <p class="mt-2 text-muted">No comments yet. Be the first to share your thoughts!</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}


