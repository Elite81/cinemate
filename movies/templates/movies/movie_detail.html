{% extends "movies/base.html" %}

{% block content %}
<div class="bg-dark text-light py-5">
    <div class="container my-5">

        <div class="row g-4">
            <!-- Poster -->
            <div class="col-md-4">
                <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" 
                     class="img-fluid rounded shadow" 
                     alt="{{ movie.title }}">
            </div>

            <!-- Movie Info -->
            <div class="col-md-8">
                <h1 class="fw-bold">{{ movie.title }}</h1>

                {% if movie.belongs_to_collection %}
                    <h4 class="text-muted">{{ movie.belongs_to_collection.name }}</h4>
                {% endif %}

                {% if movie.tagline %}
                    <p class="fst-italic text-warning">{{ movie.tagline }}</p>
                {% endif %}

                <!-- Genres -->
                
                <div class="mb-3">
                    {% for genre in movie.genres.all %}
                        <span class="badge bg-secondary me-1">{{ genre.name }}</span>
                    {% endfor %}
                </div>

                <!-- Overview -->
                <p>{{ movie.overview }}</p>

                <!-- Details List -->
                <ul class="list-unstyled">
                    <li><strong>Runtime:</strong> {{ movie.runtime }} min</li>
                    <li><strong>Release Date:</strong> {{ movie.release_date }}</li>
                    <li>
                        <strong>TMDB Rating:</strong> {{ movie.vote_average }}/10 
                        ({{ movie.vote_count }} votes)
                    </li>

                    <!-- Rating Form -->
                    {% if user.is_authenticated %}
                    <li class="mt-3">
                        <form method="post" action="{% url 'rate_movie' tmdb_id=movie.tmdb_id %}">
                            {% csrf_token %}
                            
                            <label class="form-label d-block">Rate this movie</label>
                            <div class="rating">
                                {% for i in rating_range %}
                                    <input type="radio" name="score" value="{{ i }}" id="star{{ i }}"
                                    {% if user_rating and user_rating.score == i %}checked{% endif %}>
                                    <label for="star{{ i }}">â˜…</label>
                                {% endfor %}
                            </div>
                            <button type="submit" class="btn btn-primary mt-2">Submit Rating</button>
                        </form>
                    </li>
                    {% else %}
                        <li class="mt-3">
                            <p><a href="{% url 'login' %}" class="btn btn-outline-light btn-sm">Log in</a> to rate this movie.</p>
                        </li>
                    {% endif %}

                    <li>
                        <strong>Languages:</strong>
                        {% for lang in movie.spoken_languages.all %}
                            <span class="badge bg-secondary me-1">{{ lang.name }}</span>
                        {% endfor %}
                    </li>

                    <li>
                        <strong>Countries:</strong>
                        {% for country in movie.origin_country.all %}
                            <span class="badge bg-secondary me-1">{{ country }}</span>
                        {% endfor %}
                    </li>
                </ul>

                <!-- External Links -->
                <div class="mt-4">
                    {% if movie.homepage %}
                        <a href="{{ movie.homepage }}" class="btn btn-warning me-2" target="_blank">Official Website</a>
                    {% endif %}
                    {% if movie.imdb_id %}
                        <a href="https://www.imdb.com/title/{{ movie.imdb_id }}" class="btn btn-warning me-2" target="_blank">IMDb</a>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}